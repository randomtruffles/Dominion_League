---
layout: default
title: Calendar form
permalink: calendar/form
---

<div class="home">
	<div class="container-centered">
		<h3>Calendar Form</h3>
		<p>Add your league match to the <a href="/calendar">match calendar</a>.</p>
	</div>
	<div class="form-option">
		<span>Division:</span>
		<select id="division">
			<option value=""></option>
		</select>
	</div>
	<div class="form-option">
		<p>Your username</p>
		<select id="user1" name="Your username">
			<option value=""></option>
		</select>
	</div>
	<div class="form-option">
		<p>Your opponent's username</p>
		<select id="user2" name="Your opponent's username">
			<option value=""></option>
		</select>
	</div>
	<div class="form-option">
		<p>Date and Time (UTC)</p>
		<input type="date" id="date" name="Date"></input>
		<span class="inline">at</span>
		<input type="text" id="hour" name="Hours" maxlength="2" pattern="[0-9]*" novalidate class="slidertext"></input>
		<span>:</span>
		<input type="text" id="minute" name="Minutes" maxlength="2" pattern="[0-9]*" novalidate class="slidertext"></input>
		<span class="inline">UTC</span>
		<p id="time-verify" style="color:red"></p>
	</div>
	<div class="form-option">
		<div></div>
		<p>If all fields are filled you may add to the calendar directly by clicking "Add to Calendar." Clicking "More Options" will bring you to a longer form pre-filled with the information above where you will have options such as using a non-UTC time zone, requesting commentary, and leaving additional comments.</p>
		<button id="pushout" class="inline">Add to Calendar</button>
		<button id="prefill" class="inline">More Options</button>
		<p id="submit-verify" style="color:red"></p>
	</div>
</div>
<script>
const divisions = {{ site.data.current_season | jsonify }};
var formURL = "https://docs.google.com/forms/d/e/1FAIpQLScw-U_gquzImZfwVoVmJVNbYr_oqK9gD9l2X11Hbf9J9lvuNw/substituteme?entry.1760809337=League"
var division = document.getElementById("division");
var user1 = document.getElementById("user1");
var user2 = document.getElementById("user2");
var date = document.getElementById("date");
var hours = document.getElementById("hour");
var minutes = document.getElementById("minute");
var timeMessage = document.getElementById("time-verify");
var submitMessage = document.getElementById("submit-verify");

loadPage();

function loadPage() {
	var selectedDiv = "";
	if (window.location.search) {
		let params = new URLSearchParams(window.location.search);
		if (params.has("div")) {
			selectedDiv = params.get("div").toUpperCase();;
		}
	}
	
	for (div in divisions) {
		if (/^[A-Z]\d+$/.test(div)) {
			let opt = document.createElement("option");
			opt.value = div;
			if (div == selectedDiv) {
				opt.selected = true;
			}
			opt.appendChild(document.createTextNode(div));
			division.appendChild(opt);
		}
	}
	
	division.addEventListener('change', function(ev) {
		updatePlayers(ev.target.value);
	});
	
	if (selectedDiv in divisions) {updatePlayers(selectedDiv);}
	
	hours.onblur = function() {
		var hourInput = Number(hours.value);
		if (isNaN(hourInput) || hourInput < 0 || hourInput > 23 || hourInput % 1) {
			timeMessage.innerHTML = "Hours should be an integer between 0 and 23";
			hours.value = "";
		} else {
			timeMessage.innerHTML = "";
		}
	};
	minutes.onblur = function() {
		var minuteInput = Number(minutes.value);
		if (isNaN(minuteInput) || minuteInput < 0 || minuteInput > 59 || minuteInput % 1) {
			timeMessage.innerHTML = "Minutes should be an integer between 0 and 59";
			minutes.value = "";
		} else {
			timeMessage.innerHTML = "";
		}
	};
	
	document.getElementById("pushout").onclick = function() {
		var fields = [user1, user2, date, hours, minutes];
		let unfilled = fields.filter(x => x.value == "").map(x => x.name);
		let unfilledCount = unfilled.length;
		if (unfilledCount == 0) {
			let submitURL = formURL.replace("substituteme", "formResponse");
			submitURL += `&entry.665962030=${user1.value.replace(/ /g, "+")}&entry.933461438=${user2.value.replace(/ /g, "+")}`;
			submitURL += `&entry.1984692058=${date.value}+${hours.value}:${minutes.value}`;
			window.open(submitURL+"&entry.797613395=02:00:00&submit=Submit");
			submitMessage.innerHTML = "";
			fields.forEach(x => {x.value = ""});
		} else {
			
			if (unfilledCount > 2) {
				unfilled[unfilledCount - 1] = "and " + unfilled[unfilledCount - 1];
				submitMessage.innerHTML = unfilled.join(", ") + " have not been filled."
			} else if (unfilledCount == 2) {
				submitMessage.innerHTML = unfilled.join(" and ") + " have not been filled."
			} else {
				submitMessage.innerHTML = unfilled[0] + " has not been filled."
			}
		}
	};
	
	document.getElementById("prefill").onclick = function() {
		let prefillURL = formURL.replace("substituteme", "viewform");
		if (user1.value) {
			prefillURL += `&entry.665962030=${user1.value.replace(/ /g, "+")}`;
		}
		if (user2.value) {
			prefillURL += `&entry.933461438=${user2.value.replace(/ /g, "+")}`;
		}
		if (date.value && hours.value && minutes.value) {
			prefillURL += `&entry.1984692058=${date.value}+${hours.value}:${minutes.value}`;
		}
		window.open(prefillURL+"&entry.797613395=02:00:00");
	};
}

function updatePlayers(division) {
	var members = (division in divisions) ? Object.keys(divisions[division].members).sort((a,b) => a.localeCompare(b, 'en', {'sensitivity': 'base'})) : [];
	user1.innerHTML = '<option value=""></option>';
	user2.innerHTML = '<option value=""></option>';
	for (player of members) {
		let opt1 = document.createElement("option");
		let opt2 = document.createElement("option");
		opt1.value = player;
		opt2.value = player;
		opt1.appendChild(document.createTextNode(player));
		opt2.appendChild(document.createTextNode(player));
		user1.appendChild(opt1);
		user2.appendChild(opt2);
	}
}
</script>
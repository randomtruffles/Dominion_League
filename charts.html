---
layout: default
title: Visual History
---

<div class="home">
	<div class="container-centered">
		<h3>Visual History</h3>
		<p>Visual representations of Dominion League history - take a look at players' performance over time, with more coming soon.</p>
	</div>
	
	<div class="container-centered">
		<h4>League Players</h4>
		<p>See how the league has evolved over time, or the journey of a specific player</p>
	</div>
	
	<div class="control-row">
		<div class="control-container">
			Player:
			<input type="text" id="player-input" class="chartInput">
			<button id="playerchange">Make Chart</button>
			<button id="clearplayer">Clear</button>
		</div>
		<div class="control-container">
			<label for="count" class="chartInput">
				<input type="radio" id="count" class="chartInput chartRadio" name="prop" checked="checked">
				<span>Counts</span>
			</label>
			<label for="prop" class="chartInput">
				<input type="radio" id="prop" class="chartInput chartRadio" name="prop">
				<span>Proportions</span>
			</label>
		</div>
		<div class="control-container">
			<label for="allTiers" class="chartInput">
				<input type="checkbox" id="allTiers" class="chartInput chartCheck">
				<span>Show all tiers</span>
			</label>
		</div>
	</div>
	
	<div class="control-row">
		<p class="slidePiece">Seasons:</p>
		<input type="text" id="seasontextmin" class="slidertext slidePiece" value="1">
		<div class="doubleslider-container slidePiece">
			<input type="range" id="seasonslide1" class="dslider" min="1" max="41" value="1">
			<input type="range" id="seasonslide2" class="dslider" min="1" max="1">
		</div>
		<input type="text" id="seasontextmax" class="slidertext slidePiece">
		<button id="rangereset" class="reset slidePiece">Reset Range</button> 
	</div>
	
	<div id="widthcheck"><!-- maybe put player not founds in here - I need it for determining render width --></div>
	<div id="player-history"></div>
	</br>
	
	<div class="container-centered">
		<h4>A Division Power</h4>
		<p>How the top tier has evolved. Each player gets an area corresponding to their standing in the past few seasons. Click on a player's area to see their history in the chart above.</p>
	</div>
	
	<div class="control-row">
		<p class="slidePiece">Zoom:</p>
		<div class="slidePiece">
			<label class="checkslider">
				<input type="checkbox" id="powerzoom" checked="checked">
				<span class="checkslider-button" id="powerzoom-button"></span>
			</label>
		</div>
	</div>
	
	<div id="ADiv-power"></div>
	
	<div id="standings-modal" class="modal">
		<div class="modal-content" style="text-align:center">
			<span id="closemodal" class="close">&times;</span>
			<h5 id="standings-info"></h5>
			<table class="table-past-standings">
				<tbody id="standings-table">
					<tr class="rows-past-standings">
						<th width="10%">Rank</th>
						<th width="55%" class="cells-past-standings">Player</th>
						<th width="10%" class="cells-past-standings">W</th>
						<th width="10%" class="cells-past-standings">L</th>
						<th width="15%" class="cells-past-standings">Win %</th>
					</tr>
				</tbody>
			</table>
		</div>
	</div>
	
	<script src="https://cdn.jsdelivr.net/npm/vega@5"></script>
	<script src="https://cdn.jsdelivr.net/npm/vega-lite@4"></script>
	<script src="https://cdn.jsdelivr.net/npm/vega-embed@6"></script>
	<script>
	//setup variables
	var currentStandings = {{ site.data.current_season | jsonify }};
	var currentSeason = currentStandings.season;
	var playerCurrentStandings = null;
	var counts = {{ site.data.chart_counts | jsonify }};
	function getCurrentCounts() {
		var tiers = "ABCDEFGHIJP";
		var currentCounts = {};
		for (let i=0; i<11; i++) {
			currentCounts[tiers[i]] = {"season": String(currentSeason), "tier": tiers[i], "divisions": 0, "players": 0};
		}
		var totalPlayers = 0;
		var divisions = Object.keys(currentStandings);
		for (let i = divisions.length-1; i>=2; i--) {
			currentCounts[currentStandings[divisions[i]].tier].divisions += 1;
			let divPlayers = Object.keys(currentStandings[divisions[i]].members).length;
			currentCounts[currentStandings[divisions[i]].tier].players += divPlayers;
			totalPlayers += divPlayers;
		}
		currentCounts = Object.keys(currentCounts).map(key => currentCounts[key]);
		for (let i=0; i<11; i++) {
			currentCounts[i].lfrac = String(currentCounts[i].players/totalPlayers);
			currentCounts[i].divisions = String(currentCounts[i].divisions);
			currentCounts[i].players = String(currentCounts[i].players);
		}
		return currentCounts;
	}
	if (counts[counts.length-1].season != currentSeason) {counts = counts.concat(getCurrentCounts())};
	var countsLength = counts.length;
	var placeHistory = {{ site.data.chart_history | jsonify }};
	var placeHistoryLength = placeHistory.length;
	var proportion = false;
	var allTiers = false;
	var player = null;
	var seasonRange = [1,currentSeason];
	var userSetRange = false;
	var power = {{ site.data.chart_power | jsonify }};
	var powerLength = power.length;
	var APlayers = [];
	for (let i=0; i<powerLength; i+=currentSeason) {
		APlayers.push(power[i].player);
	}
	APlayers.sort(function(a,b) {
		if (a.toLowerCase() < b.toLowerCase()) {
			return -1;
		} else if (a.toLowerCase() > b.toLowerCase()) {
			return 1;
		} else if (a.toLowerCase() == b.toLowerCase()) {
			return 0;
		}  
	});
	var powerPlotZoom = true;
	var playerPlot = null;
	var powerPlot = null;

	//url parameters handling
	getURLparams();
	function getURLparams() {
		if (window.location.search) {
			let params = new URLSearchParams(window.location.search);
			player = params.get('player');
			proportion = Boolean(params.get('prop') == 'true');
			if (proportion) {document.getElementById('prop').checked = "checked";}
		}
	}
	function setURLparams() {
		let searchString = "?"
		if (player) {
			searchString += "player=" + player.replace(" ", "%20");
		}
		if (proportion) {
			searchString += "&".repeat(searchString.length > 1) + "prop=true";
		}
		window.history.replaceState(null, null, searchString);
	}
	
	//setup season range controls
	var seasonslide1 = document.getElementById("seasonslide1");
	var seasonslide2 = document.getElementById("seasonslide2");
	var seasontextmin = document.getElementById("seasontextmin");
	var seasontextmax = document.getElementById("seasontextmax");

	seasonslide1.max = currentSeason;
	seasonslide2.max = currentSeason;
	seasonslide2.value = currentSeason;
	seasontextmax.value = currentSeason;

	seasonslide1.oninput = slideinput;
	seasonslide2.oninput = slideinput;
	seasontextmax.oninput = textinput;
	seasontextmin.oninput = textinput;
	seasontextmax.onblur = slideinput;
	seasontextmin.onblur = slideinput;
	
	//make plots and have them resize with window
	document.getElementById('player-history').style.padding = 0;
	widthcheck = document.getElementById('widthcheck');
	makePlayerPlot();
	makePowerPlot();
	window.onresize = function() {
		playerPlot.width(widthcheck.clientWidth - 94);
		playerPlot.height(0.6 * (widthcheck.clientWidth - 94));
		playerPlot.runAsync();
		powerPlot.width(widthcheck.clientWidth - 78);
		powerPlot.height((powerPlotZoom ? 3 : 1) * (widthcheck.clientWidth - 78));
		powerPlot.runAsync();
	};

	function slideinput() {
		if (Number(seasonslide1.value) <= Number(seasonslide2.value)) {
			seasontextmin.value = seasonslide1.value;
			seasontextmax.value = seasonslide2.value;
		} else {
			seasontextmin.value = seasonslide2.value;
			seasontextmax.value = seasonslide1.value;
		}
		
		seasonRange = [Number(seasontextmin.value), Number(seasontextmax.value)];
		userSetRange = true;
		makePlayerPlot();
	}

	function textinput() {
		if ((Number(seasontextmin.value) <= Number(seasontextmax.value)) && (Number(seasontextmin.value) >= Number(seasonslide1.min)) && (Number(seasontextmax.value) <= Number(seasonslide1.max))) {
			if (Number(seasonslide1.value) <= Number(seasonslide2.value)) {
				seasonslide1.value = seasontextmin.value;
				seasonslide2.value = seasontextmax.value;
			} else {
				seasonslide1.value = seasontextmax.value;
				seasonslide2.value = seasontextmin.value;
			}
			
			seasonRange = [Number(seasontextmin.value), Number(seasontextmax.value)];
			userSetRange = true;
			makePlayerPlot();
		}
	}

	document.getElementById('rangereset').onclick = resetRange;
	function resetRange() {
		seasonRange = [1,currentSeason];
		userSetRange = false;
		seasontextmin.value = 1;
		seasontextmax.value = currentSeason;
		seasonslide1.value = 1;
		seasonslide2.value = currentSeason;
		makePlayerPlot();
	}


	document.getElementById('playerchange').onclick = function() {
		player = document.getElementById('player-input').value;
		allTiers = document.getElementById('allTiers').checked;
		setURLparams();
		makePlayerPlot();
	};

	document.getElementById('clearplayer').onclick = function() {
		document.getElementById('player-input').value = "";
		player = null;
		setURLparams();
		if (userSetRange) {makePlayerPlot();} else {resetRange();};
	};

	document.getElementById('count').onclick = function() {
		document.getElementById('count').blur();
		if (proportion) {
			proportion = false;
			allTiers = document.getElementById('allTiers').checked;
			setURLparams();
			makePlayerPlot();
		}
	};

	document.getElementById('prop').onclick = function() {
		document.getElementById('prop').blur();
		if (!proportion) {
			proportion = true;
			setURLparams();
			makePlayerPlot();
		}					
	};

	document.getElementById('allTiers').onclick = function() {
		document.getElementById('allTiers').blur();
		allTiers = document.getElementById('allTiers').checked;						
		makePlayerPlot();
	};
	
	//power chart zoom control	
	document.getElementById('powerzoom').onclick = function() {
		powerPlotZoom = powerPlotZoom ? false : true;
		makePowerPlot();
	};
	
	function makePlayerPlot() {
		var pHist = [];
		var lHist = [];
		var tiers = [];
		var seasons = [];
		var fCounts = [];
		
		if (player) {
			//data slicing
			//isolate records for relevant player
			let lowerplayer = player.toLowerCase();
			for (let i = 0; i < placeHistoryLength; i++) {
				if ((placeHistory[i].player.toLowerCase() == lowerplayer) && (Number(placeHistory[i].season) >= seasonRange[0]) && (Number(placeHistory[i].season) <= seasonRange[1])) {
					pHist.push(placeHistory[i]);
					pHist[pHist.length-1].chart = 'point';
					seasons.push(placeHistory[i].season);
					tiers.push(placeHistory[i].tier);
				}
			}
			
			//add information for current season if player is in it
			if ((currentSeason <= seasonRange[1]) && Object.keys(currentStandings.players).includes(lowerplayer) && (!pHist.length || (pHist[pHist.length-1].season != currentSeason))) {
				let pname = currentStandings.players[lowerplayer].name;
				var currentHistory = {"player": pname, "tier": currentStandings.players[lowerplayer].tier, "division": currentStandings.players[lowerplayer].division};
				playerCurrentStandings = Object.keys(currentStandings[currentHistory.division].members).map(key => currentStandings[currentHistory.division].members[key]);
				playerCurrentStandings.sort((a,b) => a.rank - b.rank);
				let rank = currentStandings[currentHistory.division].members[pname].rank;
				currentHistory.place = String(rank);
				currentHistory.season = String(currentSeason);
				let countBase = 0;
				let countMult = 0;
				let propBase = 0;
				let propMult = 0;
				for (let i = countsLength-1; i >= 0; i--) {
					if (Number(counts[i].season) < currentSeason) {
						break;
					} else if (counts[i].tier == currentHistory.tier) {
						countMult = Number(counts[i].players);
						propMult = Number(counts[i].lfrac);
					} else if (counts[i].tier < currentHistory.tier) {
						countBase += Number(counts[i].players);
						propBase += Number(counts[i].lfrac);
					}
				}
				currentHistory.countPlacement = String(countBase + (rank-0.5)*countMult/playerCurrentStandings.length)
				currentHistory.propPlacement = String(propBase + (rank-0.5)*propMult/playerCurrentStandings.length)
				currentHistory.champ = "in progress";
				currentHistory.chart = "point";
				pHist.push(currentHistory);
				seasons.push(currentHistory.season);
				tiers.push(currentHistory.tier);
			}
			
			var played2MostRecent = (seasons[seasons.length - 1] == currentSeason) && (seasons[seasons.length - 2] == currentSeason - 1) && (pHist[pHist.length - 1].champ == "in progress");
			
			if (pHist.length) {
				//correct capitalization
				player = pHist[0].player;
				document.getElementById('player-input').value = player;
				
				//set allTiers to true if proportion is true
				if (proportion) {allTiers = true;}
			
				//find missing seasons and insert nulls
				let start = userSetRange ? seasonRange[0] : Number(seasons[0]);
				let end = userSetRange ? seasonRange[1] : Number(seasons[seasons.length-1]);
				var toadd = [];
				for (let s = start; s <= end; s++) {
					if (!(seasons.includes(String(s)))) {
						pHist.push({"player":player, "tier":null, "division":null, "place":null, "season":String(s), "countPlacement":null, "propPlacement":null, "champ":null});
						toadd.push(String(s));
					}
				}
				pHist.sort(function(a,b){return a.season - b.season});
				seasons = seasons.concat(toadd).sort(function(a,b){return a - b});
				
				//show range on sliders if it changes upon plot making
				if (!userSetRange) {
					seasontextmin.value = seasons[0];
					seasontextmax.value = seasons[seasons.length - 1];
					seasonslide1.value = seasons[0];
					seasonslide2.value = seasons[seasons.length - 1];
				}
				
				//find needed tiers
				var minTier = tiers.sort()[tiers.length - 1]
				if (allTiers) {
					tiers = ["A","B","C","D","E","F","G","H","I","J","P"];
				} else {
					let potTiers = ["A","B","C","D","E","F","G","H","I","J","P"];
					let tempTiers = [];
					for (let i = 0; i < potTiers.length; i++) {
						if (potTiers[i] <= minTier) {tempTiers.push(potTiers[i]);} else {break;}
					}
					tiers = tempTiers;
				}
				
				var colors = ["#FF00FF","#9900FF","#0000FF","#4A85E8","#00FFFF","#00FF00","#FFFF00","#FF9800","#FF0000","#980000","#B7B7B7"];
				//cut colors because layers with same encoding annoyingly union their domains
				colors = colors.slice(0,tiers.length).concat(["#000000", "#000000", "#FFFF00", "#FFFFFF"]);
				
				//filter counts to desired 
				if (allTiers) {
					for (let i = 0; i < countsLength; i++) {
						if (seasons.includes(counts[i].season)) {
							fCounts.push(counts[i]);
							fCounts[fCounts.length - 1].chart = "bar";
						}
					}
				} else {
					for (let i = 0; i < countsLength; i++) {
						if (seasons.includes(counts[i].season) && tiers.includes(counts[i].tier)) {
							fCounts.push(counts[i]);
							fCounts[fCounts.length - 1].chart = "bar";
						}
					}
				}
				
				//filter out later E seasons if player was in E before season 27
				if (tiers[tiers.length - 1] == "E") {
					let oldOnly = true;
					for (let i = pHist.length - 1; i >= 0; i--) {
						if (pHist[i].tier == "E" && Number(pHist[i].season > 26)) {
							oldOnly = false;
							break;
						}
					}
					if (oldOnly) {
						for (let i = fCounts.length - 1; i >= 0; i--) {
							if ((Number(fCounts[i].season) > 26) && (fCounts[i].tier == "E")) {
								fCounts.splice(i,1);
							}
						}
					}
				}
				
				//duplicate player history for line chart
				lHist = JSON.parse(JSON.stringify(pHist));
				for (let i=lHist.length-1; i>=0; i--) {
					lHist[i].chart = "line";
				}
				//make row for lines if played last two seasons
				if (played2MostRecent) {
					lHist.push(JSON.parse(JSON.stringify(lHist[lHist.length - 2])));
					lHist[lHist.length - 1].champ = "in progress";
				}
				if (minTier == "P") {
					for (let i = lHist.length - 1; i >= 0; i--) {
						if (lHist[i].tier == "P") {
							lHist.splice(i,1);
						}
					}
				}
				
				var layers = [
					{
						"transform": [{"filter": "datum.chart == 'bar'"}],
						"mark": "bar",
						"encoding": {
							"x": {
								"field": "season",
								"type": "ordinal",
								"scale": {
									"domain": seasons
								},
								"axis": {"title": "Season"}
							},
							"y": {
								"field": proportion ? "lfrac" : "players",
								"type": "quantitative",
								"scale": {
									"reverse": true,
									"domain": proportion ? [0,1] : null
								},
								"axis": {"title": "Position"}
							},
							"color": {
								"field": "tier",
								"type": "nominal",
								"scale": {
									"domain": tiers,
									"range": colors
								},
								"legend": {
									"title": "Tier",
									"values": tiers,
									"symbolType": "square",
									"symbolStrokeWidth": 0,
									"symbolSize": 200
								}
							},
							"order": {"field":"tier", "sort":"ascending"}
						}
					},
					{
						"transform": [
							{"filter": "datum.chart == 'line'"},
							{"calculate": "if(datum.season.length == 1, '0' + datum.season, datum.season)", "as": "order"},
							{"calculate": "if(datum.champ == 'in progress', 'yes', 'no')", "as": "future"}
						],
						"mark": {"type": "line", "stroke": "#000000"},
						"encoding" : {
							"x": {"field": "season", "type": "ordinal"},
							"y": {
								"field": proportion ? "propPlacement" : "countPlacement",
								"type": "quantitative"
							},
							"strokeDash": {
								"field": "future",
								"type": "nominal",
								"scale": {
									"domain": ["no", "yes"],
									"range": [[1,0], [8,8]]
								},
								"legend": null
							},
							"order": {"field": "order", "type": "ordinal"}
						}
					},
					{
						"transform": [{"filter": "datum.chart == 'point'"}],
						"selection": {
							"hovered": {"type": "single", "on": "mouseover", "empty": "none"},
							"clicked": {"type": "single", "on": "click", "empty": "none"}
						},
						"mark": {
							"type": "point",
							"filled": true,
							"opacity": "1",
							"stroke": "#000000",
							"strokeWidth": "1"
						},
						"encoding": {
							"x": {"field": "season", "type": "ordinal"},
							"y": {
								"field": proportion ? "propPlacement" : "countPlacement",
								"type": "quantitative"
							},
							"color": {
								"field": "champ",
								"type": "nominal",
								"scale": {
									"domain": ["no", "division", "league", "in progress"]
								}
							},
							"shape": {
								"field": "champ",
								"type": "nominal",
								"scale": {
									"domain": ["no", "division", "league", "in progress"],
									"range": [
										"M 0 -1 A 1 1 0 1 1 0 1 A 1 1 0 1 1 0 -1", 
										"M 0 -2 L -0.36327126400268 -0.5 L -1.90211303259031 -0.618033988749895 L -0.587785252292473 0.190983005625053 L -1.17557050458495 1.61803398874989 L -7.56848349501309e-17 0.618033988749895 L 1.17557050458495 1.6180339887499 L 0.587785252292473 0.190983005625053 L 1.90211303259031 -0.618033988749894 L 0.363271264002681 -0.5 L 4.89842541528951e-16 -2 L -0.36327126400268 -0.5",
										"M 0 -2.4 L -0.435925516803217 -0.6 L -2.28253563910837 -0.741640786499874 L -0.705342302750968 0.229179606750063 L -1.41068460550194 1.94164078649987 L -9.0821801940157e-17 0.741640786499874 L 1.41068460550194 1.94164078649987 L 0.705342302750968 0.229179606750063 L 2.28253563910837 -0.741640786499873 L 0.435925516803217 -0.6 L 5.87811049834741e-16 -2.4 L -0.435925516803216 -0.600000000000001",
										"M 0 -1 A 1 1 0 1 1 0 1 A 1 1 0 1 1 0 -1"
									]
								},
								"legend": null
							},
							"size": {"condition": {"selection": "hovered", "value": "60"}, "value": "40"},
							"tooltip": (widthcheck.clientWidth < 540) ? null : [
								{"field": "season", "type": "nominal", "title": "Season"},
								{"field": "division", "type": "nominal", "title": "Division"},
								{"field": "place", "type": "nominal", "title": "Place"}
							]
						}
					}
				];
			} else {
				//add message saying not found at some point
				var layers = nullPlotLayer(fCounts);
			}
		} else {
			var layers = nullPlotLayer(fCounts);
		}
		
		const playerSpec = {
			"title": player ? ("League History: " + player) : "League History",
			"width": widthcheck.clientWidth - 94, //little bit off with scrollbar, worry when doing resizing for window
			"height": 0.6 * (widthcheck.clientWidth - 94),
			"data": {"values": pHist.concat(lHist, fCounts)},
			"layer": layers
		};
		vegaEmbed("#player-history", playerSpec, {"actions": false}).then(function(res) {
			playerPlot = res.view;
			if (pHist.length) {
				playerPlot.addDataListener('clicked_store', function(name, value){
					if (value.length) {
						let roi = pHist[value[0].values[0]-1];						
						showStandingsModal(roi.season, roi.division);
					}
				})
			}
		});
	}

	function nullPlotLayer(fCounts) {
		let seasons = [];
		let start = userSetRange ? seasonRange[0] : 1;
		let end = userSetRange ? seasonRange[1] : currentSeason;
		for (let s = start; s <= end; s++) {seasons.push(String(s));}
		for (let i = 0; i < countsLength; i++) {
			if ((Number(counts[i].season) >= start) && (Number(counts[i].season) <= end)) {
				fCounts.push(counts[i]);
				fCounts[fCounts.length - 1].chart = "bar";
			}
		}
		
		return [{
			"transform": [{"filter": "datum.chart == 'bar'"}],
			"mark": "bar",
			"encoding": {
				"x": {
					"field": "season",
					"type": "ordinal",
					"scale": {
						"domain": seasons
					},
					"axis": {"title": "Season"}
				},
				"y": {
					"field": proportion ? "lfrac" : "players",
					"type": "quantitative",
					"scale": {
						"reverse": true,
						"domain": proportion ? [0,1] : null
					},
					"axis": {"title": proportion ? "Proportion" : "Position"}
				},
				"color": {
					"field": "tier",
					"type": "nominal",
					"scale": {
						"domain": ["A","B","C","D","E","F","G","H","I","J","P"],
						"range": ["#FF00FF","#9900FF","#0000FF","#4A85E8","#00FFFF","#00FF00","#FFFF00","#FF9800","#FF0000","#980000", "#B7B7B7"]
					},
					"legend": {
						"title": "Tier",
						"values": ["A","B","C","D","E","F","G","H","I","J","P"],
						"symbolType": "square",
						"symbolStrokeWidth": 0,
						"symbolSize": 200
					}
				},
				"order": {"field":"tier", "sort":"ascending"}
			}
		}];
	}

	function showStandingsModal(season, division) {
		document.getElementById('standings-info').innerHTML = '<a href="/' + ((season == currentSeason) ? 'current_standings' : 'past_standings/season' + season) + '?div=' + division + '" target="_blank">Season ' + season + ' Division ' + division + ' Standings</a>';
		var table = document.getElementById('standings-table');
		table.innerHTML = '<tr class="rows-past-standings"><th width="10%">Rank</th><th width="55%" class="cells-past-standings">Player</th><th width="10%" class="cells-past-standings">W</th><th width="10%" class="cells-past-standings">L</th><th width="15%" class="cells-past-standings">Win %</th></tr>';
		if ((season == currentSeason) && playerCurrentStandings) {
			for (let i=0; i < playerCurrentStandings.length; i++) {
				let row = document.createElement('tr');
				row.classList.add('rows-past-standings')
				let names = ['rank', 'name', 'wins', 'losses']
				for (let j = 0; j < 4; j++) {
					let cell = document.createElement('td');
					cell.classList.add('cells-past-standings');
					cell.appendChild(document.createTextNode(playerCurrentStandings[i][names[j]]));
					row.appendChild(cell);
				}
				//handle pct separately to add background color
				let cell = document.createElement('td');
				cell.classList.add('cells-past-standings');
				cell.style.cssText = 'background-color:' + playerCurrentStandings[i].color;
				cell.appendChild(document.createTextNode(playerCurrentStandings[i].pct));
				row.appendChild(cell);
				table.appendChild(row);
			}
		} else {
			for (let i=0; i < placeHistoryLength; i++) {
				if ((placeHistory[i].season == season) && (placeHistory[i].division == division)) {
					let row = document.createElement('tr');
					row.classList.add('rows-past-standings')
					let names = ['place', 'player', 'wins', 'losses']
					for (let j = 0; j < 4; j++) {
						let cell = document.createElement('td');
						cell.classList.add('cells-past-standings');
						cell.appendChild(document.createTextNode(placeHistory[i][names[j]]));
						row.appendChild(cell);
					}
					//handle pct separately to add background color
					let cell = document.createElement('td');
					cell.classList.add('cells-past-standings');
					cell.style.cssText = 'background-color:' + placeHistory[i].standingsColor;
					cell.appendChild(document.createTextNode(placeHistory[i].pct));
					row.appendChild(cell);
					table.appendChild(row);
				}
			}
		}
		document.getElementById("standings-modal").style.display = "block";
	}
	
	document.getElementById('closemodal').onclick = closemodal;
	window.onclick = function(ev) {if (event.target == document.getElementById('standings-modal')) {closemodal()}};
	
	function closemodal() {document.getElementById("standings-modal").style.display = "none";}
	
	function makePowerPlot() {
		var widthOffset = powerPlotZoom ? 0.1 : 0.61;
	
		var colors = ['#944246','#7C5C34','#8E991E','#6F1448','#000000','#74C4BA','#434596','#52B75E','#FC329C','#45EF87','#701567','#6FC296','#C58D3F','#A0EE4F','#39D93A','#128802','#67A7D1','#03B76F','#000000','#D612C9','#024784','#228BEA','#22C0B3','#37FC36','#B250AC','#8A8901','#0211B0','#000000','#63302B','#DE2226','#431D64','#DED557','#46A178','#6CB300','#5AD0E1','#420288','#904301','#CD1485','#7F3FC6','#187C44','#60911B','#0F6419','#911CFD','#1B156D','#A02C1B','#C1739B','#BC9FFC','#CF7111','#517B33','#860302','#284F8F','#7A3575','#000000','#FEEC34','#00FFFF','#DE42F0'];
		
		const powerSpec = {
			"title": "A Division History",
			"width": widthcheck.clientWidth - 78, //little bit off with scrollbar, worry when doing resizing for window
			"height": (powerPlotZoom ? 3 : 1) * (widthcheck.clientWidth - 78),
			"data": {"values": power},
			"layer": [
				{
					"mark": {"type": "area"},
					"transform": [{"calculate": "indexof(" + JSON.stringify(APlayers) + ", datum.player)", "as": "order"}],
					"selection": {
						"hovered": {"type": "single", "on": "mouseover", "empty": "all"},
						"clicked": {"type": "single", "on": "click", "empty": "none"}
					},
					"encoding": {
						"y": {
							"field": "season",
							"type": "ordinal",
							"axis": {
								"grid": true,
								"orient": "left"
							}
						},
						"x": {
							"field": "prop",
							"type": "quantitative",
							"scale": {
								"domain": [0-widthOffset,1+widthOffset]
							},
							"axis": {
								"title": null,
								"grid": false,
								"ticks": false,
								"values": []
							}
						},
						"color": {
							"field": "player",
							"type": "nominal",
							"scale": {
								"domain": APlayers,
								"range": colors
							},
							"legend": null
						},
						"order": {"field": "order", "type": "quantitative"},
						"opacity": {"condition": {"selection": "hovered", "value": 1}, "value": 0.3},
						"tooltip": [{"field": "player", "type": "nominal"}]
					}
				},
				{
					"mark": {"type": "point", "strokeWidth": 0},
					"encoding": {"y": {"field": "season", "axis": {"orient": "right"}}}
				}
			]
		};
		vegaEmbed("#ADiv-power", powerSpec, {"actions": false}).then(function(res) {
			powerPlot = res.view;
			powerPlot.addDataListener('clicked_store', function(name, value){
				if (value.length) {
					player = power[value[0].values[0]-1].player;
					allTiers = document.getElementById('allTiers').checked;
					setURLparams();
					makePlayerPlot();
				}
			})
		});
	}
	</script>
</div>